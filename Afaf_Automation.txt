import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.interactions.Actions;
import org.testng.Assert;
import org.testng.annotations.BeforeClass;

import java.time.Duration;
import java.util.List;
import java.util.Locale;
import java.util.Random;

public class finalProject {
    public static void main(String[] args) throws InterruptedException {
        // T.C5
        WebDriver driver;
        driver = new ChromeDriver();
        driver.manage().window().maximize();
        driver.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        driver.findElement(By.cssSelector("hidden-xs hidden-sm hidden-md")).click();
        //select.selectByVisibleText("€ Euro");
        driver.findElement(By.name("EUR")).click();
        Thread.sleep(200);
        WebElement price = driver.findElement(By.id("cart-total"));
        System.out.println("the count after chang" + price.getText());
        //الرجعوع لختيار الدولار\n"+
        driver.findElement(By.cssSelector("hidden-xs hidden-sm hidden-md")).click();
        driver.findElement(By.name("USD")).click();
        //التحقق مره اخري
        WebElement priceAgain = driver.findElement(By.id("cart-total"));
        System.out.println("العملة بعد رجوع الدولار" + priceAgain.getText());
        Assert.assertEquals(price.getText(), priceAgain.getText(), "currency did not change");
        //اغلاق المتصفح
        driver.quit();

        //T.C 6
        WebDriver driver1;
        driver1 = new ChromeDriver();
        Random random = new Random();
        driver1.manage().window().maximize();
        driver1.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        //اخيار فئة رئسية عشوائية
        List<WebElement> mainCategories = driver1.findElements(By.cssSelector(".nav.navbar-nav>1i"));
        int mainIndex = random.nextInt(mainCategories.size());
        WebElement selectedMain = mainCategories.get(mainIndex);
        String mainName = selectedMain.getText();
        System.out.println("main category selected" + mainName);
        selectedMain.click();
        //حفظurl  بعد اختبار الفئة الرئيسية
        String mainurl = driver1.getCurrentUrl();
        // البحث عن الفئات الفرعية
        List<WebElement> subCategories = driver1.findElements(By.cssSelector(".list-group a"));
        if (!subCategories.isEmpty()) {
            int subIdex = random.nextInt(subCategories.size());
            WebElement selectedsub = subCategories.get(subIdex);
            String subName = selectedsub.getText();
            System.out.println("sub category selected" + subName);
            selectedsub.click();
            //تاكيد الصفحة اتغيرت
            String suburl1 = driver1.getCurrentUrl();
            if (!suburl1.equals(mainurl)) {
                System.out.println("Assertion passed: page change successfully to subcategory.");
            }
        } else {
            System.out.println("Assertion failed : page did not chang after clicking subcategory ");
        }
        driver1.quit();
        System.out.println("no subcategories found for this main category");

                //T.C7
        WebDriver driver2;
        driver2 = new ChromeDriver();
        ;
        driver2.manage().window().maximize();
        driver2.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        // جلب كل الفئات الرئيسية
        List<WebElement> maincategories = driver2.findElements(By.cssSelector(".nav.navber_nav>1i"));
        int mainindex = random.nextInt(maincategories.size());
        WebElement SelectedMain = maincategories.get(mainindex);
        String MainName = selectedMain.getText();
        System.out.println("Hovering on main category" + mainName);
        //hoverعلي الفئة الرئيسية
        Actions actions = new Actions(driver2);
        actions.moveToElement(selectedMain).perform();
        Thread.sleep(200);
        //محاولة جلب الفئات الفرعية داخل الفئة المختارة
        List<WebElement> SUbcategories = selectedMain.findElements(By.cssSelector("u1 1i"));
        ;
        if (SUbcategories.isEmpty()) {
            int subINdex = random.nextInt(SUbcategories.size());
            WebElement selectedSUb = SUbcategories.get(subINdex);
            String subNAme = selectedSUb.getText();
            System.out.println("Hover on Sub Category" + subNAme);
            //hoverعلي الفئة الفرعية
            actions.moveToElement(selectedSUb).perform();
            ;
            Thread.sleep(200);
        } else {
            System.out.println("no subcategories found under this main category");
        }
        driver2.quit();

        //T.C8 Category Selection
        WebDriver driver3;
        driver3 = new ChromeDriver();;
        Random random1 = new Random();;
        driver3.manage().window().maximize();
        driver3.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        //الضغط علي login link
          driver3.findElement(By.cssSelector("a[title=My Account]")).click();
          driver3.findElement(By.linkText("Login")).click();
          //ادخال بينات تسجيل الدخول
        driver3.findElement(By.id("input-email")).sendKeys("afafatta2004@gmail.com");
        driver3.findElement(By.id("input-password")).sendKeys("gdfHgaDi3Pz@rp");
        driver3.findElement(By.cssSelector("input[type='continue']")).click();
        // اختيار فئة رئيسية عشوائية بعد تسجيل الدخول
        List<WebElement>MainCategoRies=driver3.findElements(By.cssSelector(".nav.navber_nav>1i"));
        if (MainCategoRies.isEmpty()){
            System.out.println("Assertion faild: No categories found");
            return;
        }
        int MainInDex=random1.nextInt(MainCategoRies.size());
        WebElement SelectedMaiN=MainCategoRies.get(MainInDex);
        String mainNAME=selectedMain.getText();
        System.out.println("Main Category Selected"+mainNAME);
        //حفظURL قبل الضغط
        String beforeclickURL=driver3.getCurrentUrl();
        selectedMain.click();
        // حغظ URL قبل الضغط
        String afterclickURL=driver3.getCurrentUrl();
        if (!beforeclickURL.equals(afterclickURL)){
            System.out.println("Assertion passed:URL change after selecting category");}
        else {
            System.out.println("Assertion failed:URL did not change after selecting category");
            driver3.quit();
        }

        //T.C17add item to the cart through compare list
        WebDriver driver4;
        driver4 = new ChromeDriver();;
        driver4.manage().window().maximize();
        driver4.manage().timeouts().implicitlyWait(Duration.ofSeconds(4));
        driver4.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        //اختيار منتج من الصفحة الرئيسه
        List<WebElement> product= driver4.findElements(By.cssSelector(".product_thumb"));
        WebElement firstproduct =product.get(0);
        //الضغط علي compare this product
        WebElement compareBtn= firstproduct.findElement(By.cssSelector("button[data_original_title='compare this product']"));
        compareBtn.click();
        //انتقال الي صفحة المقارنة
        driver4.navigate().to("https://awesomeqa.com/ui/index.php?route=product/compare");;
        //الضغط علي add to cart من صفحة المقارته
        WebElement addtocartfromcompare=driver4.findElement(By.cssSelector(".btn.btn_primary"));
        addtocartfromcompare.click();
        //التحقق مت ان المنتج تمت اضافتة للسلة
        driver4.findElement(By.id("cart_total")).click();
        String cartContent=driver4.findElement(By.cssSelector("dropdown_menu.pull_right")).getText();
        //Assertion:نتاكد ان السلة تحتوي علي المنتج
        Assert.assertTrue(cartContent.toLowerCase().contains("product"),"product was not added to cart from compare list");
        System.out.println("Test passed: product successfully added to cart from compare list");
        driver4.quit();


       // T.C18 add the same item to the cart
        WebDriver driver5;
        driver5 = new ChromeDriver();;
        driver5.manage().window().maximize();
        driver5.manage().timeouts().implicitlyWait(Duration.ofSeconds(6));
        driver5.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        //الدخول الي صفحة المنتج
        WebElement Firstproduct=driver5.findElement(By.cssSelector(".ptoduct_thumb "))  ;
        WebElement productLink= firstproduct.findElement(By.cssSelector("h4 a"));
        productLink.click();
        //اضافة المنتج للسلة مرتين
        WebElement addToCartButton=driver5.findElement(By.id("button_cart"));
        addToCartButton.click();//اول مرة
        addToCartButton.click();//ثاني مرة
        // فتحة السلة و التحقق من الكمية
        driver5.findElement(By.id("cart_total")).click();
       WebElement viewcartbtn=driver5.findElement(By.cssSelector("p.text_a:nth_of_type(1)"));;//view car
        viewcartbtn.click();
        //التحقق من الكمية =2
        WebElement quantityfield=driver5.findElement(By.cssSelector("input[name*='quantity']"));
        String quantity = quantityfield.getDomAttribute("value");
        //Assertion
        Assert.assertEquals(quantity,"2","product was not added twice to the cart as expected");
        System.out.println("Test passed: product quantity is 2 in the cart ");
        driver5.quit();

       // T.c19add address book to my account
        WebDriver driver6;
        driver6 = new ChromeDriver();;
        driver6.manage().window().maximize();
        driver6.manage().timeouts().implicitlyWait(Duration.ofSeconds(5));
        driver6.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        driver6.findElement(By.id("input-email")).sendKeys("afafatta2004@gmail.com");
        driver6.findElement(By.id("input-password")).sendKeys("gdfHgaDi3Pz@rp");
        driver6.findElement(By.cssSelector("input[value='login']")).click();
        //الدخول الي address book
        driver6.findElement(By.linkText("Address Book")).click();
        //الضغط علي new address
        driver6.findElement(By.linkText("New Address")).click();
        //ملاء نموذج العنوان
        driver6.findElement(By.id("input-firstname")).sendKeys("afaf");
        driver6.findElement(By.id("input-lastname")).sendKeys("atta");
        driver6.findElement(By.id("input-address-1")).sendKeys("zagizg");
        driver6.findElement(By.id("input-city")).sendKeys("zagizg");
        //الدولة و المحافظة
        WebElement CountryDropdown = driver6.findElement(By.id("input_country"));
        CountryDropdown.findElement(By.cssSelector("option[value='64']")).click();//egypt
        WebElement zeroDropdown=driver6.findElement(By.id("input_zone"));
        zeroDropdown.findElement(By.cssSelector("option[value='1009']")).click();//cairo
        //حفظ العنوان
        driver6.findElement(By.cssSelector("input[value='Continue']")).click();
        // تحقق من نجاح العملية
        WebElement alert=driver6.findElement(By.cssSelector(".alert_success"));
        String alertText=alert.getText();
        Assert.assertTrue(alertText.contains("successfully added Address was not added successfully"));
        System.out.println("Test passed:Address added successfully");
        driver6.quit();

        //T.C20 add more than 4 items to the compare list
        WebDriver driver7;
        driver7 = new ChromeDriver();;
        driver7.manage().window().maximize();
        driver7.manage().timeouts().implicitlyWait(Duration.ofSeconds(5));
        driver7.navigate().to("https://awesomeqa.com/ui/index.php?route=common/home");
        //الحصول علي اول5  منتجان
        List<WebElement> products=driver7.findElements(By.cssSelector(".product_thumb"));
        int addedCount=0;
        for (int i=0;i<5 && i<products.size();i++){
            WebElement Product=products.get(i);
               WebElement compareButton=
                  Product.findElement(By.xpath(".//button[@data_original_title='compare this product']"));
               compareButton.click();
               ++addedCount;
             Thread.sleep(40);
          }
             //فتح صفحة المقارنة
        driver7.findElement(By.id("compare_total")).click();
        // التحقق من عدد المنتجات في صفحة المقارنة
        List<WebElement> compareItems=driver7.findElements(By.cssSelector(".table.table_bordered .name a"));
        int compareCount=compareItems.size();
        //assertion- لازم العدد ميزدش عن 4
        Assert.assertTrue(compareCount<=4,"Compare list should contain max 4 items, but found"+compareCount);
        System.out.println("Test passed: Compare list contains"+compareCount+"items");
        driver7.quit();